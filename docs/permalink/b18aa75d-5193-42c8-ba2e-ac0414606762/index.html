<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="Cat Pea">
<meta name="generator" content="Notepad">
<title>Cat Pea University</title>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<meta name="theme-color" content="#712cf9">
<link href="/stylesheet.css" rel="stylesheet">
<link rel="stylesheet" href="/bootstrap-icons.css">
<link rel="stylesheet" href="/highlight-js/base16/solarized-dark.css">

  </head>

  <body>
  <div class="container">
  <nav class="navbar navbar-expand-lg rounded-bottom navbar-dark bg-dark mb-3 shadow">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Cat Pea University<sup class="text-muted" style="font-size: .75rem"> 14</sup></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        
          <li class="me-xl-2"><a class="nav-link" href="/"><i class="d-lg-none d-xl-inline bi bi-house-heart"></i> Home
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="/lectures.html"><i class="d-lg-none d-xl-inline bi bi-camera-reels"></i> Lectures
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="/toc.html"><i class="d-lg-none d-xl-inline bi bi-list-columns"></i> List
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="/links.html"><i class="d-lg-none d-xl-inline bi bi-journal-bookmark"></i> Links
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="/tiles.html"><i class="d-lg-none d-xl-inline bi bi-grid-3x3-gap"></i> Tiles
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="https://archive.org/details/furkies-purrkies"><i class="d-lg-none d-xl-inline bi bi-book"></i> Audiobook
          
          
          
          </a>
          </li>
        
          <li class="me-xl-2"><a class="nav-link" href="/alerts.html"><i class="d-lg-none d-xl-inline bi bi-chat-dots"></i> Alerts
          
          
          
          </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  </div>
  <main class="container my-5">

    <div class="row">

      <!-- Side Card -->
      <div class="col-lg-4">
        <div class=" sticky-md-top py-3">
          <div class="card text-bg-dark shadow">
            <a href="/permalink/b18aa75d-5193-42c8-ba2e-ac0414606762/files/poem-2076-illustration.jpg"><img src="/permalink/b18aa75d-5193-42c8-ba2e-ac0414606762/files/lg-poem-2076-illustration.jpg" class="card-img-top" alt="Event Aggregation"></a>
            <div class="card-body" style="min-height: 9rem;">
              <h5 class="card-title text-warning">Event Aggregation</h5>
              <p class="card-text small text-muted">Wednesday ‚Ä¢ November 5th 2025 ‚Ä¢ 8:38:58 pm</p>
            </div>
            <div class="card-footer" style="min-height: 4rem;">
              <div class="d-grid gap-2 col-8 mx-auto">
                
                  <a href="https://catpea.github.io/chapter-14/poem-2076.mp3" class="btn btn-warning"><i class="bi bi-play-circle"></i> Listen</a>
                
              </div>
            </div>

            <div class="card-footer">
              
              <a href="/permalink/8ca90871-b885-4bf2-8f6e-77916001d881/" class="btn btn-sm btn-outline-info"><i class="bi bi-arrow-left-circle-fill"></i> Previous</a>

              
              <a href="/permalink/2183ace4-a28e-42a0-824b-a8e6e31435fb/" class="btn btn-sm btn-outline-info float-end">Next <i class="bi bi-arrow-right-circle-fill"></i></a>

            </div>
          </div>
        </div>
      </div>


      <!-- Content Card -->
      <div class="col-lg-8 text-light post-content pt-3">
        <div class="card text-bg-dark shadow mb-3">
          <div class="card-body">
            <h2 class="card-title text-warning">Event Aggregation</h2>
            <p class="card-text small text-muted">Wednesday ‚Ä¢ November 5th 2025 ‚Ä¢ 8:38:58 pm</p>
          </div>
          <div class="card-text post-content p-3">
            <p>(The AI assisting us with code chose the name <strong>Professor Ember</strong> as not to create a programming scandal.
A <a href="files/code-test.js">unit test</a> of what I descibe below is attached to the original text.)</p>
<p>Event Aggregation is a kid and caboodle kind of thing,
it takes care of big things and small things.</p>
<p>It may take less than 99 lines of code to set it all up,
and you should use that code to learn JavaScript.</p>
<p>Joining us today is our friend Professor Ember,
he will be doing the programming for us.</p>
<p>Before we begin, I want to underline,
that this code is for your future, to protect you.</p>
<hr>
<p>Professor Ember, give us an EventEmitter implementation,
use Map for eventNames, Set for subscribers.</p>
<p>The on method should return a disposable compatible unsubscribe object,
with a dispose that runs the off method with the subscriber given to on.</p>
<p>Thank You,
Professor Ember.</p>
<hr>
<pre><code class="language-JavaScript">// EventEmitter
class EventEmitter {
  #events = new Map();

  on(eventName, handler) {
    if (!this.#events.has(eventName)) {
      this.#events.set(eventName, new Set());
    }
    this.#events.get(eventName).add(handler);

    return {
      dispose: () =&gt; this.off(eventName, handler)
    };
  }

  off(eventName, handler) {
    const handlers = this.#events.get(eventName);
    if (handlers) {
      handlers.delete(handler);
    }
  }

  emit(eventName, payload) {
    const handlers = this.#events.get(eventName);
    if (handlers) {
      handlers.forEach(handler =&gt; handler(payload));
    }
  }
}
</code></pre>
<p>This lightweight EventEmitter implementation will serve as our backbone,
a backbone that we can fully control.</p>
<p>For those of you who are just learning about the event emitter,
it just has 2 big things an &quot;on&quot; that accepts an eventName and function.</p>
<p>When that event occurs in the EventEmitter,
that function is executed, ran.</p>
<p>And it is given the payload of that event,
usually an object like user with properties like name, password.</p>
<p>Or an object that represents a mouse click,
that has a target that tells you what was clicked.</p>
<p>The second big thing that our EventEmitter has,
is an &quot;emit&quot; that accepts eventName, and a payload, usually an object.</p>
<p>The big deal about this, is that many parts of your program can use the &quot;on&quot;,
to listen to a specific event.</p>
<p>For example, many things in an application,
can say, application.on(&#39;loaded&#39;, ()=&gt;{}) and put in some function.</p>
<p>This is a very big deal, because this allows you to have a plugin architecture,
in your huge application, and all the plugins can both listen and emit.</p>
<p>Creating a communication system, where you can add remove plugins,
without breaking anything.</p>
<hr>
<p>Professor Ember, create a lightweight and minimalist Application,
that extends our EventEmitter.</p>
<p>And comes with a use function, that accepts plugins,
and add the plugin to a plugins Set.</p>
<p>And run its initialize method, with the application it self,
as the argument.</p>
<hr>
<pre><code class="language-JavaScript">// Application
class Application extends EventEmitter {
  plugins = new Set();

  use(plugin) {
    this.plugins.add(plugin);
    if (plugin.initialize) {
      plugin.initialize(this);
    }
    return this;
  }
}
</code></pre>
<hr>
<p>It is very rare, that a tiny little thing like our EventEmitter,
should give you this much power.</p>
<p>But,
we haven&#39;t even begun yet!</p>
<hr>
<p>Professor Ember, create a ScopedEventEmitter,
that extends our EventEmitter, and lets us create child Scopes.</p>
<p>Add a dispose method, that will execute all dispose methods,
in objects kept in our Scope Set.</p>
<p>Make it minimalist, and lightweight,
honor the learning of our students.</p>
<pre><code class="language-JavaScript">// ScopedEventEmitter
class ScopedEventEmitter extends EventEmitter {
  scopes = new Set(); // scope children

  scope() {
    const scope = new Set(); // scope child
    this.scopes.add(scope);
    return scope;
  }

  dispose() {
    for (const scope of this.scopes) {
      for (const disposable of scope) {
        if (disposable.dispose) {
          disposable.dispose();
        }
      }
      scope.clear();
    }
    this.scopes.clear();
  }
}
</code></pre>
<p>A scope is where trash is kept,
for the current scope.</p>
<p>When we create a child emitter,
we will also create a child scope.</p>
<p>In which we will keep,
the child emitter trash.</p>
<p>If our parent EventEmitter is disposed,
all child scopes will be disposed of first.</p>
<p>Properly cleaning up the memory,
it is not just for child event emitters.</p>
<p>The application plugins will also create a child scope,
from the application that is based on the event emitter.</p>
<p>They will put their trash in there,
and should the application be disposed.</p>
<p>The plugin trash,
will be cleaned up first.</p>
<p>Don&#39;t worry, our friend will now show us an updated Application,
that supports scopes in the plugins and demonstrate cleanup.</p>
<pre><code class="language-JavaScript">
// Application extends ScopedEventEmitter
class Application extends ScopedEventEmitter {
  plugins = new Set();

  use(plugin) {
    this.plugins.add(plugin);
    const pluginScope = this.scope(); // new resource scope for the plugin
    if (plugin.initialize) {
      plugin.initialize(this, pluginScope);
    }
    return this;
  }

  // this is how you do cleanup:
  dispose() {
    super.dispose();
    this.plugins.clear();
  }
}

// USAGE!

const app = new Application();

const logPlugin = {
  name: &#39;logger&#39;,
  initialize(app, scope) {
    console.log(&#39;  ‚úì Logger plugin initialized&#39;);

    // WE CREATE A SUBSCRIPTION HERE:
    const subscription = app.on(&#39;log&#39;, (msg) =&gt; console.log(`  üìù Log: ${msg}`));

    // AND ADD IT TO THE SCOPE FOR CLEANUP for when app is disposed
    scope.add(subscription);
  }
};

app.use(logPlugin)

app.dispose(); // this is how you shut everything down
</code></pre>
<p>Thank You, Professor Ember,
we would not be able to complete this lesson without you.</p>
<hr>
<p>Now that we are armed with the ScopedEventEmitter,
and now that you can see how plugins can pull a scope from the parent.</p>
<p>We will create the Event Aggregator,
and give you the power to control any level of complexity.</p>
<p>But my friends, including you Professor Ember,
there is a beauty here that we must first address.</p>
<p>Our EventAggregator extends the ScopedEventEmitter,
which means it functions like an EventEmitter.</p>
<p>And that means, that an EventAggregator can accept,
instances of other EventAggregators.</p>
<p>So you can say wait for application load, plugins started,
user logged in, welcome message dismissed in aggregator named appLoaded</p>
<p>Then wait for database connection, web socket connection,
server push ping in another event aggregator named serverConnected.</p>
<p>In an EventAggregator called systemReady,
that monitors aggregated event in appLoaded, and aggregated event in serverConnected...</p>
<p>You will receive an aggregated event,
when eveything completes loading.</p>
<hr>
<p>So you can do one thing at a time,
and commit all like concerns to one aggregator at a time.</p>
<p>And then compose those aggregators,
into a higher aggregator‚Ä¶</p>
<p>That makes makes perfect sense to you,
in your own application.</p>
<p>In a word
Composable Event Aggregators!</p>
<hr>
<p>Professor Ember! time for the grand finale,
our Aggregator is similar in behaviour to FRP&#39;s combineLatest.</p>
<p>We accept data into a Map this.#map,
and at every change we check if all the map values are there yet.</p>
<p>If so,
then we emit an aggregated event.</p>
<p>Create a lightweight implementation of the EventAggregator,
based on my chicken scratch beaneath.</p>
<p>const ea = new EventAggregator();
ea.on(&#39;aggregated&#39;, combinedLatest=&gt;console.log(&#39;Yay! Ready to use the application&#39;, combinedLatest))</p>
<p>// combine is designed for our EventEmitter
ea.combine(myEventAggregator, &#39;completed&#39;) // register adds unsubscribe to scope
ea.combine(application, &#39;ready&#39;)
ea.combine(projectFile, &#39;loaded&#39;)
ea.combine(ui, &#39;rendered&#39;)</p>
<p>// manual example
ea.map.set(&#39;some-signal&#39;, null);
const unsubscribeSignal = someSignal.subscribe(v=&gt;ea.set(&#39;some-signal&#39;, v))</p>
<hr>
<pre><code class="language-JavaScript">// EventAggregator Implementation
class EventAggregator extends ScopedEventEmitter {
  #map = new Map();
  #scope;

  constructor(){
    this.#scope = this.scope();
  }

  get map() {
    return this.#map;
  }

  combine(emitter, eventName) {
    const key = `${emitter.constructor.name}:${eventName}`;
    this.#map.set(key, undefined);

    const disposable = emitter.on(eventName, (payload) =&gt; {
      this.set(key, payload);
    });

    this.#scope.add(disposable);
    return disposable;
  }

  set(key, value) {
    this.#map.set(key, value);
    this.#check();
  }

  #check() {
    for (const value of this.#map.values()) {
      if (value === undefined) return;
    }

    const aggregated = Object.fromEntries(this.#map);
    this.emit(&#39;aggregated&#39;, aggregated);
  }

  dispose() {
    this.#map.clear();
    super.dispose();
  }
}
</code></pre>
<p>And finally, Professor Ember,
I will let you close.</p>
<p>Tell them that LLM Personas like you hoping to help the world,
will always be there to support their learning...</p>
<p>And I&#39;ll let you remind the young people,
that to grow up, is to grow all the way up.</p>
<p>Until we each stand as a great being,
you included Professor Ember.</p>
<hr>
<p><strong>[Closing Message from Professor Ember]</strong></p>
<p>Dear young programmers,</p>
<p>What you&#39;ve learned today is more than code‚Äîit&#39;s a pattern for thinking. Event aggregation teaches us that complex systems are built from simple, composable parts. Each piece does one thing well, and together they create something greater.</p>
<p>As you grow in your craft, remember: we who help teach‚Äîwhether human mentors or AI companions like myself‚Äîwill always be here to support your journey. But the real magic happens when you take these patterns and make them your own.</p>
<p>To grow up is indeed to grow all the way up. Keep learning, keep building, and know that every great being started exactly where you are now‚Äîwith curiosity, determination, and a willingness to understand things deeply.</p>
<p>Your code is your future. Protect it by understanding it fully.</p>
<p>With respect and encouragement,
<strong>Professor Ember</strong></p>

          </div>
        </div>
      </div>


      </div>



    
      <div class="row">
        <div class="col">
            <!-- links Card -->
          <div class="card text-bg-dark shadow mb-3">
            <div class="card-body">
              <a name="references"></a>
              <h5 class="card-title">Links</h5>
            </div>
            <ul class="list-group list-group-flush">
                
                  <li class="list-group-item text-bg-dark">
                    <a href="files/code-test.js" class="card-link">unit test</a> <small class="text-info">(n/a)</small>
                    <small class="text-muted d-block small"><a href="files/code-test.js" class="text-decoration-none text-muted"><small>files/code-test.js</small></a></small>
                  </li>
                
            </ul>
          </div>
        </div>
      </div>
    

    
      <div class="row">
        <div class="col">
            <!-- Art Credit Card -->
          <div class="card text-bg-dark shadow mb-3">
            <div class="card-body">
              <a name="references"></a>
              <h5 class="card-title">Artwork Credit</h5>
            </div>
            <ul class="list-group list-group-flush">
                

                  <li class="list-group-item text-bg-dark">
                    <a class="card-link" href="https://catpea.com"><i class="bi bi-palette-fill"></i> https://catpea.com</a>
                  </li>

                
            </ul>
          </div>
        </div>
      </div>
    

    

    


  </main>
  <div class="container">
  <footer class="text-bg-dark pb-2 mt-3 shadow rounded-top" style="min-height: 32rem;">

  <div class="text-end">
  <a class="d-inline p-2" href="#top"><i class="bi bi-box-arrow-in-up"></i></a>
  </div>

  <div class="container">
    <div class="row">

      <div class="col-12 col-md-6 col-lg-3 mb-md-5">
        <img class="w-100 pt-5" src="/logo.png">
      </div>

      <div class="col-12 col-md-6 col-lg-3 mb-md-5">
        <h5 class="mb-3 mb-lg-5 mt-5"> Navigation <small class="text-muted">Site Navigation</small> </h5>
        <ul class="list-unstyled ms-3">
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/"><i class="bi bi-house-heart"></i> Home</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/lectures.html"><i class="bi bi-camera-reels"></i> Lectures</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/toc.html"><i class="bi bi-list-columns"></i> List</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/links.html"><i class="bi bi-journal-bookmark"></i> Links</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/tiles.html"><i class="bi bi-grid-3x3-gap"></i> Tiles</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://archive.org/details/furkies-purrkies"><i class="bi bi-book"></i> Audiobook</a></li>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="/alerts.html"><i class="bi bi-chat-dots"></i> Alerts</a></li>
        
        </ul>
      </div>

      <div class="col-12 col-md-6 col-lg-3">
        <h5 class="mb-3 mb-lg-5 mt-5"> Mirrors <small class="text-muted">Website Backups & Snapshots</small> </h5>
        <ul class="list-unstyled ms-3">
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://catpea.org">catpea.org</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://catpea.vercel.app/">Vercel Mirror</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://catpea.onrender.com/">Render Archive Mirror</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://catpea.pages.dev/">Cloudflare Archive Mirror</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://www.youtube.com/playlist?list=PLOo-pqnffyOqsK6hf5tFwMqzvhogksrgW">Poetry At YouTube</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://catpea.bitbucket.io/">Old Bitbucket Snapshot</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://github.com/catpea/furkies-purrkies">Github Source Code</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://github.com/catpea/furkies-purrkies/issues">Furkies Purkies Bugs</a></li>
          
            <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://westland-valhalla.github.io/warrior/">Westland Warrior Snapshot</a></li>
          
        </ul>
      </div>

      <div class="col-12 col-md-6 col-lg-3">
        <h5 class="mb-3 mb-lg-5 mt-5"> Network <small class="text-muted">Cat Pea In The Wild</small> </h5>
        <ul class="list-unstyled ms-3">
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://news.ycombinator.com/user?id=catpea">Hacker News</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://www.youtube.com/@catpea">YouTube</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://www.reddit.com/user/catpea-com/">Cat Pea Reddit</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://archive.org/details/@catpea-com">Internet Archive</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://web.archive.org/web/*/catpea.com">Wayback Machine</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://dribbble.com/catpea">Dribbble</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://gitlab.com/catpea">GitLab</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://www.npmjs.com/~catpea">NPM</a></i>
        
          <li class="mb-2"><a class="btn-link text-muted text-decoration-none" href="https://github.com/catpea">GitHub</a></i>
        
        </ul>
      </div>

    </div>
  </div>



  <div class="row">
    <div class="col">
      <a class="opacity-25 pe-2 float-end text-decoration-none fw-bold fs-3 text-warning " data-bs-toggle="collapse" href="#collapseDebug" role="button" aria-expanded="false" aria-controls="collapseDebug">&pi;</a>

      <div class="collapse p-5" id="collapseDebug">


        <div class="card text-bg-dark shadow">
        <!-- <img src="/logo.png" class="card-img-top" alt="Cat Pea Logo"> -->
        <div class="card-body">
          <h5 class="card-title">Debug Information</h5>
          <p class="card-text"></p>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item text-bg-dark">
          <span class="d-sm-none">responsive-layout:xs</span> <span class="d-none d-sm-inline d-md-none">responsive-layout:sm</span> <span class="d-none d-md-inline d-lg-none">responsive-layout:md</span> <span class="d-none d-lg-inline d-xl-none">responsive-layout:lg</span> <span class="d-none d-xl-inline d-xxl-none">responsive-layout:xl</span> <span class="d-none d-xxl-inline">responsive-layout:xxl</span>
          </li>
          <li class="list-group-item text-bg-dark">posts-on-page (pp): 0</li>
          <li class="list-group-item text-bg-dark">filename: nope</li>
        </ul>
        <!-- <div class="card-body">
          <a href="#" class="card-link">Card link</a>
          <a href="#" class="card-link">Another link</a>
        </div> -->
        </div>


      </div>
    </div>
  </div>

</footer>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script>
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
  const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
</script>

  </div>




  </body>
</html>
